<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿæ¶æ„å¸ˆæ¯æ—¥ç‰¹è®­</title>
    <style>
        :root { --primary: #722ed1; --sec: #f9f0ff; --bg: #f4f5f7; --text: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--text); line-height: 1.6; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .header { background: #fff; padding: 15px 20px; position: sticky; top: 0; z-index: 99; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 18px; color: #111; display: flex; align-items: center; }
        .header .badge { background: var(--primary); color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
        .date-tag { font-size: 12px; color: #888; }

        .container { max-width: 680px; margin: 0 auto; padding: 15px; }

        /* é€‰é¡¹å¡ */
        .tabs { display: flex; background: #e6e6e6; padding: 4px; border-radius: 12px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; font-size: 14px; border-radius: 10px; cursor: pointer; color: #666; font-weight: 500; }
        .tab.active { background: #fff; color: var(--primary); font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card { background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); }
        .card-title { font-size: 16px; font-weight: bold; color: var(--primary); margin-bottom: 12px; display: flex; align-items: center; }
        .card-title::before { content: ''; display: inline-block; width: 4px; height: 16px; background: var(--primary); margin-right: 8px; border-radius: 2px; }
        
        /* Markdown å†…å®¹æ ·å¼ */
        .md-content { font-size: 15px; color: #444; }
        .md-content b { color: #000; background: rgba(114, 46, 209, 0.1); padding: 0 4px; border-radius: 2px; }
        .md-content h3, .md-content h4 { margin: 10px 0 5px; color: #333; font-size: 15px; }
        .md-content ul { padding-left: 20px; margin: 5px 0; }
        .md-content li { margin-bottom: 5px; }

        /* é‡ç‚¹ç²¾è®²å¡ç‰‡ */
        .deep-dive { border: 1px solid #e0c8ff; background: #fdfaff; }
        
        /* è®ºæ–‡æŒ‡å¯¼å¡ç‰‡ */
        .essay-box { background: #fffbe6; border: 1px solid #ffe58f; color: #876800; font-size: 14px; padding: 15px; border-radius: 8px; }

        /* é¢˜ç›®æ ·å¼ */
        .quiz-wrapper { display: none; }
        .quiz-item { display: none; animation: fadeIn 0.3s; }
        .quiz-item.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .q-text { font-size: 16px; font-weight: bold; margin-bottom: 15px; color: #222; }
        .option { padding: 14px; border: 1px solid #eee; border-radius: 10px; margin-bottom: 10px; cursor: pointer; display: flex; transition: all 0.2s; background: #fff; }
        .option:active { background: #fafafa; }
        .option.selected { background: #f3e6ff; border-color: var(--primary); }
        .option.correct { background: #f6ffed; border-color: #52c41a; }
        .option.wrong { background: #fff1f0; border-color: #ff4d4f; }
        
        .analysis-panel { background: #f7f8fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 3px solid #888; display: none; font-size: 14px; }

        /* åº•éƒ¨æ“ä½œæ  */
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; padding: 12px 20px; box-shadow: 0 -4px 12px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; max-width: 680px; margin: 0 auto; z-index: 100; display: none; }
        .btn { padding: 10px 24px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-default { background: #f0f0f0; color: #555; }
        .progress-text { font-weight: bold; color: #666; font-variant-numeric: tabular-nums; }

        #loading { text-align: center; padding-top: 100px; color: #999; }
    </style>
</head>
<body>

<div class="header">
    <div>
        <h1>æ¶æ„å¸ˆæ¯æ—¥ç‰¹è®­ <span class="badge">V2.1</span></h1>
        <div class="date-tag" id="date-display">...</div>
    </div>
</div>

<div class="container">
    <div id="loading">ğŸš€ æ­£åœ¨åŠ è½½é«˜é¢‘è€ƒç‚¹ä¸çœŸé¢˜...</div>

    <div id="app" style="display:none">
        <!-- é¡¶éƒ¨åˆ‡æ¢ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">ğŸ“š æ·±åº¦å­¦ä¹ </div>
            <div class="tab" onclick="switchTab(1)">âš”ï¸ çœŸé¢˜å®æˆ˜ (10)</div>
        </div>

        <!-- Tab 1: å­¦ä¹ å†…å®¹ -->
        <div id="view-study">
            <!-- 1. æ ¸å¿ƒè€ƒç‚¹æ‘˜è¦ -->
            <div class="card">
                <div class="card-title">ğŸ’¡ æ ¸å¿ƒè€ƒç‚¹</div>
                <div class="md-content" id="core-concept"></div>
            </div>

            <!-- 2. æ·±åº¦ç²¾è®²ä¸è®°å¿† (æ–°å¢) -->
            <div class="card deep-dive">
                <div class="card-title">æ ¸å¿ƒçŸ¥è¯†ç‚¹è®²è§£</div>
                <div class="md-content" id="knowledge-exp"></div>
            </div>

            <!-- 3. è®ºæ–‡ä¸æ¡ˆä¾‹æŒ‡å¯¼ -->
            <div class="card">
                <div class="card-title">ğŸ“ è®ºæ–‡/æ¡ˆä¾‹æŒ‡å¯¼</div>
                <div class="essay-box" id="essay-guide"></div>
            </div>
            
            <div style="height: 20px;"></div>
            <button class="btn btn-primary" style="width:100%; padding: 15px;" onclick="switchTab(1)">çŸ¥è¯†ç‚¹å·²æŒæ¡ï¼Œå¼€å§‹åˆ·é¢˜ â”</button>
        </div>

        <!-- Tab 2: åˆ·é¢˜ -->
        <div id="view-quiz" class="quiz-wrapper">
            <div id="quiz-list"></div>
        </div>
    </div>
</div>

<!-- åº•éƒ¨åˆ·é¢˜æ§åˆ¶æ  -->
<div class="footer" id="footer-bar">
    <button class="btn btn-default" onclick="changeQ(-1)">ä¸Šä¸€é¢˜</button>
    <span class="progress-text" id="q-progress">1 / 10</span>
    <button class="btn btn-primary" id="btn-next" onclick="changeQ(1)">ä¸‹ä¸€é¢˜</button>
</div>

<script>
    let rawData = null;
    let currIdx = 0;
    const TOTAL_Q = 10; // è®¾å®šé¢˜ç›®æ•°

    // Markdown ç®€å•è§£æ
    const renderMD = (text) => {
        if (!text) return "";
        return text
            .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // åŠ ç²—
            .replace(/^#+\s+(.*$)/gm, '<h4>$1</h4>') // æ ‡é¢˜
            .replace(/\n/g, '<br>'); // æ¢è¡Œ
    };

    window.onload = async () => {
        const params = new URLSearchParams(window.location.search);
        const dateStr = params.get('date');
        
        if(!dateStr) {
            document.getElementById('loading').innerText = "âŒ é“¾æ¥ç¼ºå°‘æ—¥æœŸå‚æ•°";
            return;
        }

        try {
            // åŠ æ—¶é—´æˆ³é¿å…ç¼“å­˜
            const res = await fetch(`./docs/data/${dateStr}.json?t=${Date.now()}`);
            if(!res.ok) throw new Error("Data not found");
            rawData = await res.json();
            initUI(dateStr);
        } catch(e) {
            console.error(e);
            document.getElementById('loading').innerText = "âš ï¸ ä»Šæ—¥é¢˜åº“å°šæœªç”Ÿæˆï¼Œè¯·ç¨ååˆ·æ–°";
        }
    };

    function initUI(date) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('date-display').innerText = `${date} | ${rawData.topic}`;

        // æ¸²æŸ“å­¦ä¹ å†…å®¹
        document.getElementById('core-concept').innerHTML = renderMD(rawData.core_concept);
        document.getElementById('knowledge-exp').innerHTML = renderMD(rawData.knowledge_explanation);
        document.getElementById('essay-guide').innerHTML = renderMD(rawData.essay_guide);

        // æ¸²æŸ“é¢˜ç›®
        const list = document.getElementById('quiz-list');
        rawData.questions.forEach((q, idx) => {
            const el = document.createElement('div');
            el.className = `quiz-item ${idx === 0 ? 'active' : ''}`;
            el.id = `q-card-${idx}`;
            
            const optionsHtml = q.options.map((opt, oid) => {
                const letter = opt.substring(0, 1);
                return `<div class="option" onclick="checkAnswer(${idx}, ${oid}, '${letter}', this)">${opt}</div>`;
            }).join('');

            el.innerHTML = `
                <div class="q-text">${idx+1}. ${q.question}</div>
                <div>${optionsHtml}</div>
                <div class="analysis-panel" id="analysis-${idx}">
                    <strong>âœ… å‚è€ƒç­”æ¡ˆï¼š${q.answer}</strong><br><br>
                    ${renderMD(q.analysis)}
                </div>
            `;
            list.appendChild(el);
        });
        
        updateFooter();
    }

    // äº¤äº’é€»è¾‘
    window.switchTab = function(idx) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
        document.getElementById('view-study').style.display = idx === 0 ? 'block' : 'none';
        document.getElementById('view-quiz').style.display = idx === 1 ? 'block' : 'none';
        document.getElementById('footer-bar').style.display = idx === 1 ? 'flex' : 'none';
    }

    window.checkAnswer = function(qIdx, oIdx, userVal, el) {
        if(el.parentElement.querySelector('.selected')) return; // åªæœ‰ä¸€æ¬¡æœºä¼š
        
        const q = rawData.questions[qIdx];
        const correctVal = q.answer.trim().toUpperCase();
        
        el.classList.add('selected');
        if(userVal === correctVal) {
            el.classList.add('correct');
        } else {
            el.classList.add('wrong');
            // æ˜¾ç¤ºæ­£ç¡®é¡¹
            const correctIndex = ['A','B','C','D'].indexOf(correctVal);
            if(correctIndex >= 0) el.parentElement.children[correctIndex].classList.add('correct');
        }
        
        document.getElementById(`analysis-${qIdx}`).style.display = 'block';
    }

    window.changeQ = function(dir) {
        const next = currIdx + dir;
        if(next < 0 || next >= rawData.questions.length) return;
        
        document.getElementById(`q-card-${currIdx}`).classList.remove('active');
        currIdx = next;
        document.getElementById(`q-card-${currIdx}`).classList.add('active');
        updateFooter();
    }

    function updateFooter() {
        document.getElementById('q-progress').innerText = `${currIdx + 1} / ${rawData.questions.length}`;
        document.getElementById('btn-next').innerText = (currIdx === rawData.questions.length - 1) ? "ğŸ‰ å®Œæˆ" : "ä¸‹ä¸€é¢˜";
    }
</script>
</body>
</html>
