<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿæ¶æ„å¸ˆå¤‡è€ƒç³»ç»Ÿ</title>
    <style>
        :root { --primary: #722ed1; /* æ¶æ„å¸ˆç´« */ --bg: #f7f7f8; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; color: #333; }
        .header { background: #fff; padding: 20px; text-align: center; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 99; }
        .header h1 { margin: 0; font-size: 18px; color: #1f1f1f; }
        .header .badge { background: var(--primary); color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 4px; vertical-align: middle; margin-left: 5px; }
        
        .container { max-width: 640px; margin: 0 auto; padding: 15px; }
        
        /* Tabs */
        .tabs { display: flex; background: #e0e0e0; border-radius: 10px; padding: 4px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; font-size: 14px; border-radius: 8px; cursor: pointer; color: #666; font-weight: 500; transition: all 0.2s; }
        .tab.active { background: #fff; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-weight: bold; }

        /* Cards */
        .card { background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .card h3 { margin-top: 0; color: var(--primary); font-size: 16px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .content-md { font-size: 15px; line-height: 1.7; color: #444; }
        .content-md b { color: #000; background: #f0f0ff; padding: 0 2px; }

        /* Essay Box */
        .essay-box { background: #fffbe6; border: 1px solid #ffe58f; padding: 15px; border-radius: 8px; font-size: 14px; color: #876800; line-height: 1.6; }
        .essay-title { font-weight: bold; margin-bottom: 8px; display: block; }

        /* Quiz */
        .quiz-item { display: none; }
        .quiz-item.active { display: block; }
        .q-text { font-weight: bold; font-size: 16px; margin-bottom: 15px; }
        .option { padding: 12px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; cursor: pointer; display: flex; }
        .option.selected { border-color: var(--primary); background: #f9f0ff; }
        .option.correct { border-color: #52c41a; background: #f6ffed; }
        .option.wrong { border-color: #ff4d4f; background: #fff1f0; }
        .analysis { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 14px; display: none; }
        
        /* Footer */
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; max-width: 640px; margin: 0 auto; display: none; }
        .btn { padding: 10px 25px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; background: var(--primary); color: #fff; }
        .btn-sec { background: #f0f0f0; color: #333; }

        #loading { text-align: center; padding: 40px; color: #999; }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ›ï¸ æ¶æ„å¸ˆå¤‡è€ƒ <span class="badge">é«˜çº§</span></h1>
    <p style="font-size:12px; color:#999; margin:5px 0 0" id="date-display">Loading...</p>
</div>

<div class="container">
    <div id="loading">æ­£åœ¨åŠ è½½çœŸé¢˜ä¸è®ºæ–‡æŒ‡å¯¼...</div>

    <div id="app" style="display:none">
        <div class="tabs">
            <div class="tab active" onclick="setTab(0)">ğŸ“– æ ¸å¿ƒä¸è®ºæ–‡</div>
            <div class="tab" onclick="setTab(1)">âš”ï¸ çœŸé¢˜å®æˆ˜</div>
        </div>

        <!-- Tab 1: çŸ¥è¯†ç‚¹ + è®ºæ–‡ -->
        <div id="tab-study">
            <div class="card">
                <h3>ğŸ’¡ æ ¸å¿ƒè€ƒç‚¹</h3>
                <div class="content-md" id="knowledge"></div>
            </div>
            <div class="card">
                <h3>ğŸ“ è®ºæ–‡å†™ä½œæŒ‡å¯¼</h3>
                <div class="essay-box" id="essay"></div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="setTab(1)">å¼€å§‹åˆ·é¢˜ â”</button>
            </div>
        </div>

        <!-- Tab 2: åˆ·é¢˜ -->
        <div id="tab-quiz" style="display:none">
            <div id="quiz-list"></div>
        </div>
    </div>
</div>

<div class="footer" id="footer-bar">
    <button class="btn btn-sec" onclick="moveQ(-1)">ä¸Šä¸€é¢˜</button>
    <span style="line-height: 36px; font-weight: bold; color: #666;" id="q-status">1/5</span>
    <button class="btn" id="btn-next" onclick="moveQ(1)">ä¸‹ä¸€é¢˜</button>
</div>

<script>
    let data = null;
    let currQ = 0;

    window.onload = async () => {
        const params = new URLSearchParams(window.location.search);
        const date = params.get('date');
        if(!date) return document.getElementById('loading').innerText = "é“¾æ¥æ— æ•ˆ";

        try {
            const res = await fetch(`./docs/data/${date}.json?t=${Date.now()}`);
            if(!res.ok) throw new Error("File not found");
            data = await res.json();
            render();
        } catch(e) {
            document.getElementById('loading').innerText = "âŒ é¢˜åº“åŠ è½½å¤±è´¥";
        }
    };

    function render() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('date-display').innerText = `${data.topic} | ${new URLSearchParams(window.location.search).get('date')}`;

        // æ¸²æŸ“ Markdown ç®€å•å¤„ç†
        const formatMD = (txt) => txt.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
        
        document.getElementById('knowledge').innerHTML = formatMD(data.knowledge_point);
        document.getElementById('essay').innerHTML = formatMD(data.essay_guide);

        // æ¸²æŸ“é¢˜ç›®
        const list = document.getElementById('quiz-list');
        data.questions.forEach((q, i) => {
            const el = document.createElement('div');
            el.className = `quiz-item ${i===0?'active':''}`;
            el.id = `q-${i}`;
            el.innerHTML = `
                <div class="card">
                    <div class="q-text">${i+1}. ${q.question}</div>
                    <div>
                        ${q.options.map((opt, oi) => `
                            <div class="option" onclick="check(${i}, ${oi}, '${opt[0]}', this)">${opt}</div>
                        `).join('')}
                    </div>
                    <div class="analysis" id="a-${i}">
                        <strong>âœ… å‚è€ƒç­”æ¡ˆï¼š${q.answer}</strong><br><br>${q.analysis}
                    </div>
                </div>
            `;
            list.appendChild(el);
        });
    }

    function setTab(idx) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i===idx));
        document.getElementById('tab-study').style.display = idx===0 ? 'block' : 'none';
        document.getElementById('tab-quiz').style.display = idx===1 ? 'block' : 'none';
        document.getElementById('footer-bar').style.display = idx===1 ? 'flex' : 'none';
    }

    function check(qi, oi, val, el) {
        if(el.parentElement.querySelector('.selected')) return; // å·²é€‰è¿‡
        const q = data.questions[qi];
        const correct = q.answer.trim().toUpperCase();
        
        el.classList.add(val === correct ? 'correct' : 'wrong');
        el.classList.add('selected');
        
        if(val !== correct) {
            // è‡ªåŠ¨æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
            const correctIdx = ['A','B','C','D'].indexOf(correct);
            if(correctIdx > -1) el.parentElement.children[correctIdx].classList.add('correct');
        }
        document.getElementById(`a-${qi}`).style.display = 'block';
    }

    function moveQ(dir) {
        const next = currQ + dir;
        if(next < 0 || next >= data.questions.length) return;
        document.getElementById(`q-${currQ}`).classList.remove('active');
        currQ = next;
        document.getElementById(`q-${currQ}`).classList.add('active');
        
        document.getElementById('q-status').innerText = `${currQ+1}/${data.questions.length}`;
        document.getElementById('btn-next').innerText = (currQ === data.questions.length-1) ? "å®Œæˆ" : "ä¸‹ä¸€é¢˜";
    }
</script>
</body>
</html>
